# Development

How this repo works, end to end.

## Stack

- **Runtime:** [Bun](https://bun.sh)
- **Language:** TypeScript (strict mode, ESNext)
- **Binary:** `bun build --compile` produces a standalone executable

## Commands

```bash
bun install       # Install dependencies
bun run dev       # Run src/index.ts
bun test          # Run tests
bun run build     # Compile to bin/bunny
```

## Directory Layout

```
src/              # Source code
tests/            # Tests
specs/            # Feature specs (generated by spec-kit)
dna/              # Project knowledge — roadmap, technical docs
  product/        #   ROADMAP.md lives here
  technical/      #   development-loop.md lives here
.specify/         # Spec-kit templates, scripts, and memory
  memory/         #   constitution.md — project principles
  templates/      #   spec, plan, and task templates
docs/             # You are here
```

## Coding Conventions

| Convention | Rule |
|---|---|
| Data | POD only — no classes for data, types are interfaces or type aliases |
| Naming | `snake_case` for variables/functions, `PascalCase` for types, `SCREAMING_SNAKE` for constants |
| Absence | `null` over `undefined` |
| Errors | Guard early — return errors at function top, no exceptions for control flow |
| Simplicity | Three similar lines > one premature abstraction |
| I/O | stdin/stdout/stderr, exit codes matter, JSON lines |
| Terminology | `params` for input, `result` for output, never "data" |

## Development Loop: Antagonistic Testing

Two AIs, one human.

1. **Design interface** — define the public API
2. **Design tests (Claude)** — Claude writes the first pass of test cases
3. **Review tests (Gemini)** — Gemini acts as antagonist, finds blind spots, suggests harder cases
4. **Tests lock** — after Gemini review, tests are frozen
5. **Implement** — write code to make the tests pass
6. **Loop until green** — fix failures, re-run
7. **If stuck** — human checkpoint (only when tests cannot pass)

Tests are locked after review. No changing them without human approval.

## Workflow: Picking Up Work

All work is driven by `dna/product/ROADMAP.md`.

```
ROADMAP             find the next item
  -> /speckit.specify   generate specs/{feature}/spec.md
  -> open PR            human reviews the spec
  -> /speckit.plan      generate a plan
  -> /speckit.tasks     generate task list
  -> Gemini review      antagonist reviews test cases
  -> /speckit.implement execute tasks
  -> stuck?             human checkpoint
  -> done               update ROADMAP.md
```

## Principles

The full set of project principles lives in `.specify/memory/constitution.md`. The short version:

1. **POD only** — plain old data in, plain old data out
2. **Antagonistic testing** — Claude designs, Gemini hardens, then implement
3. **Unix-clean** — null not undefined, exit codes, streams, text protocols
4. **Simplicity (YAGNI)** — no premature abstractions, no "just in case" features
